(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,34670,36159,46379,49897,52185,58540,62441,74566,88189,92332,98381,98463,99127],{12236:((S,b,c)=>{"use strict";var v,g;v=[c(49897),c(29930)],g=(function(h,E){const a={};a.init=function(t,e){const n=t.find(".draft-icon"),r=t.attr("data-uuid");function s(){$(`[component="composer"][data-uuid="${r}"]`).length&&(e.save_id||(e.save_id=utils.generateSaveId(app.user.uid)),a.addToDraftList("available",e.save_id),a.addToDraftList("open",e.save_id),o(t,n,e))}t.on("keyup","textarea, input.handle, input.title",utils.debounce(s,1e3)),t.on("click",'input[type="checkbox"]',utils.debounce(s,1e3)),t.on("click",'[component="category/list"] [data-cid]',utils.debounce(s,1e3)),t.on("itemAdded",".tags",utils.debounce(s,1e3)),t.on("thumb.uploaded",s),n.on("animationend",function(){$(this).toggleClass("active",!1)}),$(window).on("unload",function(){const i=a.getList("open");i.length&&i.forEach(m=>a.removeFromDraftList("open",m))}),a.migrateGuest()};function f(t){return parseInt(t,10)>0?localStorage:sessionStorage}a.get=function(t){if(!t)return null;const e=t.split(":")[1],n=f(e);try{const r=n.getItem(t),s=JSON.parse(r)||null;if(!s)throw new Error(`can't parse draft json for ${t}`);return s.save_id=t,s.timestamp&&(s.timestampISO=utils.toISOString(s.timestamp)),$(window).trigger("action:composer.drafts.get",{save_id:t,draft:s,storage:n}),s}catch{return console.warn(`[composer/drafts] Could not get draft ${t}, removing`),a.removeFromDraftList("available"),a.removeFromDraftList("open"),null}};function o(t,e,n){if(l(app.user.uid?"localStorage":"sessionStorage")&&n&&n.save_id&&t.length){const r=t.find("input.title"),s=r&&r.length&&r.val(),i=t.find("textarea").val(),m=f(app.user.uid);if(i.length||s&&s.length){const p={save_id:n.save_id,action:n.action,text:i,uuid:t.attr("data-uuid"),timestamp:Date.now()};if(n.action==="topics.post"){const y=t.find("input.tags").val();p.tags=y,p.title=s,p.cid=n.cid,p.thumbs=n.thumbs||[]}else n.action==="posts.reply"?(p.title=n.title,p.tid=n.tid,p.toPid=n.toPid):n.action==="posts.edit"&&(p.pid=n.pid,p.title=s||n.title,p.thumbs=n.thumbs||[]);app.user.uid||(p.handle=t.find("input.handle").val()),m.setItem(n.save_id,JSON.stringify(p)),$(window).trigger("action:composer.drafts.save",{storage:m,postData:n,postContainer:t}),e.toggleClass("active",!0)}else a.removeDraft(n.save_id)}}a.removeDraft=function(t){if(!t)return;a.removeFromDraftList("available",t),a.removeFromDraftList("open",t);const e=t.split(":")[1],n=f(e);n.removeItem(t),$(window).trigger("action:composer.drafts.remove",{storage:n,save_id:t})},a.getList=function(t){try{const e=localStorage.getItem(`drafts:${t}`);return JSON.parse(e)||[]}catch{return console.warn("[composer/drafts] Could not read list of available drafts"),[]}},a.addToDraftList=function(t,e){if(!l(app.user.uid?"localStorage":"sessionStorage")||!e)return;const n=a.getList(t);n.includes(e)||(n.push(e),localStorage.setItem("drafts:"+t,JSON.stringify(n)))},a.removeFromDraftList=function(t,e){if(!l(app.user.uid?"localStorage":"sessionStorage")||!e)return;const n=a.getList(t);n.includes(e)&&(n.splice(n.indexOf(e),1),localStorage.setItem("drafts:"+t,JSON.stringify(n)))},a.migrateGuest=function(){if(l("localStorage")&&app.user.uid){const t=/^composer:\d+:\d$/,e=Object.keys(sessionStorage).filter(function(s){return t.test(s)}),n=new Set([]),r=e.map(function(s){const i=s.split(":");return i[1]=app.user.uid,n.add(i.join(":")),i.join(":")});return e.forEach(function(s,i){localStorage.setItem(r[i],sessionStorage.getItem(s)),sessionStorage.removeItem(s)}),n.forEach(function(s){a.addToDraftList("available",s)}),n}},a.listAvailable=function(){return a.getList("available").map(a.get).filter(Boolean)},a.getAvailableCount=function(){return a.listAvailable().length},a.open=function(t){if(!t)return;const e=a.get(t);u(t,e)},a.loadOpen=function(){if(ajaxify.data.template.login||ajaxify.data.template.register||config.hasOwnProperty("openDraftsOnPageLoad")&&!config.openDraftsOnPageLoad)return;const t=a.getList("available"),e=a.getList("open");t.length&&t.forEach(function(n){if(!n||e.includes(n))return;const r=a.get(n);if(!r||!r.text&&!r.title){a.removeFromDraftList("available",n),a.removeFromDraftList("open",n);return}u(n,r)})};function u(t,e){const r=t.split(":")[1];parseInt(app.user.uid,10)===parseInt(r,10)&&Promise.all([c.e(20056),c.e(23662),c.e(65285),c.e(40559),c.e(449),c.e(5785),c.e(58540)]).then(function(){var s=[c(71431)];(function(i){e.action==="topics.post"?i.newTopic({save_id:e.save_id,cid:e.cid,handle:app.user&&app.user.uid?void 0:utils.escapeHTML(e.handle),title:utils.escapeHTML(e.title),body:e.text,tags:String(e.tags||"").split(","),thumbs:e.thumbs||[]}):e.action==="posts.reply"?h.get("/topics/"+e.tid,{},function(m,p){if(m)return E.error(m);i.newReply({save_id:e.save_id,tid:e.tid,toPid:e.toPid,title:p.title,body:e.text})}):e.action==="posts.edit"&&i.editPost({save_id:e.save_id,pid:e.pid,title:e.title?utils.escapeHTML(e.title):void 0,body:e.text,thumbs:e.thumbs||[]})}).apply(null,s)}).catch(c.oe)}function l(t){var e;try{e=window[t];var n="__storage_test__";return e.setItem(n,n),e.removeItem(n),!0}catch(r){return r instanceof DOMException&&(r.code===22||r.code===1014||r.name==="QuotaExceededError"||r.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e&&e.length!==0}}return a}).apply(b,v),g!==void 0&&(S.exports=g)}),24187:((S,b,c)=>{"use strict";var v,g;v=[c(64061)],g=(function(){const h={};h.show=function(o,u){const l=o.hasOwnProperty("fileSize")&&o.fileSize!==void 0?parseInt(o.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:o.hasOwnProperty("showHelp")&&o.showHelp!==void 0?o.showHelp:!0,fileSize:l,title:o.title||"[[global:upload-file]]",description:o.description||"",button:o.button||"[[global:upload]]",accept:o.accept?o.accept.replace(/,/g,"&#44; "):""},function(t){t.modal("show"),t.on("hidden.bs.modal",function(){t.remove()});const e=t.find("#uploadForm");e.attr("action",o.route),e.find("#params").val(JSON.stringify(o.params)),t.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),e.submit()}),e.submit(function(){return E(t,l,u),!1})})},h.hideAlerts=function(o){$(o).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function E(o,u,l){a(o,"status","[[uploads:uploading-file]]"),o.find("#upload-progress-bar").css("width","0%"),o.find("#upload-progress-box").show().removeClass("hide");const t=o.find("#fileInput");if(!t.val())return a(o,"error","[[uploads:select-file-to-upload]]");if(!f(t[0],u))return a(o,"error","[[error:file-too-big, "+u+"]]");h.ajaxSubmit(o,l)}function a(o,u,l){h.hideAlerts(o),u==="error"&&o.find("#fileUploadSubmitBtn").removeClass("disabled"),l=l.replace(/&amp;#44/g,"&#44"),o.find("#alert-"+u).translateText(l).removeClass("hide")}h.ajaxSubmit=function(o,u){o.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(t){t=d(t),a(o,"error",t.responseJSON?.status?.message||t.responseJSON?.error||`[[error:upload-error-fallback, ${t.status} ${t.statusText}]]`)},uploadProgress:function(t,e,n,r){o.find("#upload-progress-bar").css("width",r+"%")},success:function(t){let e=d(t);t.hasOwnProperty("response")&&t.hasOwnProperty("status")&&t.status.code==="ok"&&(e=t.response.images),u(e[0].url),a(o,"success","[[uploads:upload-success]]"),setTimeout(function(){h.hideAlerts(o),o.modal("hide")},750)}})};function d(o){if(typeof o=="string")try{return JSON.parse(o)}catch(u){return console.error(u),{error:"[[error:parse-error]]"}}return o}function f(o,u){return window.FileReader&&u?o.files[0].size<=u*1e3:!0}return h}).apply(b,v),g!==void 0&&(S.exports=g)}),26940:((S,b,c)=>{S.exports=c(94510)}),36159:((S,b,c)=>{"use strict";var v,g;v=[c(49897),c(33530),c(29930),c(24187),c(81335),c(17459),c(65285)],g=(function(h,E,a,d,f,o){const u={};return u.get=l=>h.get(`/topics/${l}/thumbs`,{thumbsOnly:1}),u.delete=(l,t)=>h.del(`/topics/${l}/thumbs`,{path:t}),u.updateTopicThumbs=async l=>{const t=await u.get(l),e=await app.parseAndTranslate("partials/topic/thumbs",{thumbs:t});$('[component="topic/thumb/list"]').html(e)},u.deleteAll=l=>{u.get(l).then(t=>{Promise.all(t.map(e=>u.delete(l,e.url)))})},u.upload=()=>new Promise(l=>{d.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+"/api/topic/thumb/upload"},function(t){l(t)})}),u.modal={},u.modal.open=function(l){const{id:t,postData:e}=l;let{modal:n}=l;const r=e.thumbs||[];return new Promise(s=>{f.render("modals/topic-thumbs",{thumbs:r}).then(i=>{n?o.translate(i,function(m){n.find(".bootbox-body").html(m),u.modal.handleSort({modal:n,thumbs:r})}):(n=E.dialog({title:"[[modules:thumbs.modal.title]]",message:i,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(u.upload().then(m=>{e.thumbs.push(m.replace(new RegExp(`^${config.upload_url}`),"")),u.modal.open({...l,modal:n}),Promise.all([c.e(20056),c.e(40559),c.e(449),c.e(5785),c.e(52185)]).then(function(){var p=[c(71431)];(y=>{y.updateThumbCount(t,$(`[component="composer"][data-uuid="${t}"]`)),s()}).apply(null,p)}).catch(c.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),u.modal.handleDelete({...l,modal:n}),u.modal.handleSort({modal:n,thumbs:r}))})})},u.modal.handleDelete=l=>{const t=l.modal.get(0),{id:e}=l;t.addEventListener("click",n=>{n.target.closest('button[data-action="remove"]')&&E.confirm("[[modules:thumbs.modal.confirm-remove]]",r=>{if(!r)return;const s=n.target.closest("[data-path]").getAttribute("data-path"),i=l.postData;i&&i.thumbs&&i.thumbs.includes(s)&&(i.thumbs=i.thumbs.filter(m=>m!==s),u.modal.open(l),Promise.all([c.e(20056),c.e(40559),c.e(449),c.e(5785),c.e(52185)]).then(function(){var m=[c(71431)];(p=>{p.updateThumbCount(e,$(`[component="composer"][data-uuid="${e}"]`))}).apply(null,m)}).catch(c.oe))})})},u.modal.handleSort=({modal:l,thumbs:t})=>{if(t.length>1){const e=l.find(".topic-thumbs-modal");e.sortable({items:"[data-path]"}),e.on("sortupdate",function(){if(!t)return;const n=[];e.find("[data-path]").each(function(){const r=$(this).attr("data-path"),s=t.find(i=>i===r);s&&n.push(s)}),t.length=0,Array.prototype.push.apply(t,n)})}},u}).apply(b,v),g!==void 0&&(S.exports=g)}),49897:((S,b,c)=>{"use strict";c.r(b),c.d(b,{del:()=>n,get:()=>o,head:()=>u,patch:()=>t,post:()=>l,put:()=>e});var v=c(91749),g=c.n(v),h=c(33530),E=c.n(h);const a=config.relative_path+"/api/v3";async function d(r,s){if(r.url=r.url.startsWith("/api")?config.relative_path+r.url:a+r.url,typeof s=="function"){f(r).then(i=>s(null,i),i=>s(i));return}try{return await f(r)}catch(i){if(i.message==="A valid login session was not found. Please log in and try again."){const{url:m}=await(0,v.fire)("filter:admin.reauth",{url:"login"});return(0,h.confirm)("[[error:api.reauth-required]]",p=>{p&&ajaxify.go(m)})}throw i}}async function f(r){const{url:s}=r;delete r.url,r.data&&!(r.data instanceof FormData)&&(r.data=JSON.stringify(r.data||{}),r.headers["content-type"]="application/json; charset=utf-8"),{options:r}=await(0,v.fire)("filter:api.options",{options:r}),r.data&&(r.body=r.data,delete r.data);const i=await fetch(s,r),{headers:m}=i;if(m.get("x-redirect"))return f({url:m.get("x-redirect"),...r});const p=m.get("content-type"),y=p&&p.startsWith("application/json");let A;if(r.method!=="HEAD"&&(y?A=await i.json():A=await i.text()),!i.ok)throw A?new Error(y?A.status.message:A):new Error(i.statusText);return y&&A&&A.hasOwnProperty("status")&&A.hasOwnProperty("response")?A.response:A}function o(r,s,i){return d({url:r+(s&&Object.keys(s).length?"?"+$.param(s):"")},i)}function u(r,s,i){return d({url:r+(s&&Object.keys(s).length?"?"+$.param(s):""),method:"HEAD"},i)}function l(r,s,i){return d({url:r,method:"POST",data:s,headers:{"x-csrf-token":config.csrf_token}},i)}function t(r,s,i){return d({url:r,method:"PATCH",data:s,headers:{"x-csrf-token":config.csrf_token}},i)}function e(r,s,i){return d({url:r,method:"PUT",data:s,headers:{"x-csrf-token":config.csrf_token}},i)}function n(r,s,i){return d({url:r,method:"DELETE",data:s,headers:{"x-csrf-token":config.csrf_token}},i)}}),74566:((S,b,c)=>{S.exports=c(12236)}),94510:((S,b,c)=>{"use strict";var v,g;v=[c(89596)],g=(function(h){var E={};return E.insertIntoTextarea=function(a,d){var f={context:this,textarea:a,value:d,preventDefault:!1};if($(window).trigger("action:composer.insertIntoTextarea",f),!f.preventDefault){var o=$(f.textarea),u=o.val(),l=o.parents('[component="composer"]');o.val(u.slice(0,f.textarea.selectionStart)+f.value+u.slice(f.textarea.selectionStart)),h.render(l)}},E.replaceSelectionInTextareaWith=function(a,d){var f={context:this,textarea:a,value:d,preventDefault:!1};if($(window).trigger("action:composer.replaceSelectionInTextareaWith",f),!f.preventDefault){var o=$(f.textarea),u=o.val(),l=o.parents('[component="composer"]');o.val(u.slice(0,f.textarea.selectionStart)+f.value+u.slice(f.textarea.selectionEnd)),h.render(l)}},E.wrapSelectionInTextareaWith=function(a,d,f){var o={context:this,textarea:a,leading:d,trailing:f,preventDefault:!1};if($(window).trigger("action:composer.wrapSelectionInTextareaWith",o),!o.preventDefault){f===void 0&&(f=d);var u=$(a),l=u.val(),t=/^(\s*)([\s\S]*?)(\s*)$/.exec(l.slice(a.selectionStart,a.selectionEnd));return t[2]||(t=[null,"",l.slice(a.selectionStart,a.selectionEnd),""]),u.val(l.slice(0,a.selectionStart)+t[1]+d+t[2]+f+t[3]+l.slice(a.selectionEnd)),[t[1].length,t[3].length]}},E.updateTextareaSelection=function(a,d,f){var o={context:this,textarea:a,start:d,end:f,preventDefault:!1};$(window).trigger("action:composer.updateTextareaSelection",o),!o.preventDefault&&(a.setSelectionRange(o.start,o.end),$(o.textarea).focus())},E.getBlockData=function(a,d,f){var o=a.value;d=d.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&");var u=new RegExp(d,"g"),l,t=[],e;for(o=o.split(`
`).reduce(function(n,r){return n!==null||(n=f<=r.length?r:null,n===null&&(f-=r.length+1)),n},null);(l=u.exec(o))!==null;)t.push(l.index);return e={in:!!(t.reduce(function(n,r){return f>=r+2&&(n+=1),n},0)%2),atEnd:t.reduce(function(n,r){return n||f===r},!1)},e.atEnd=e.in?e.atEnd:!1,e},E}).apply(b,v),g!==void 0&&(S.exports=g)})}]);
