"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8981,14526,42619,90954],{25955:((F,B,l)=>{var P,A;P=[l(91749),l(29930),l(89336)],A=(function(T,L,u){const E={};E.init=function(t,i){if(!t||!t.length)return;i=i||{},i.template="partials/tags/filter-dropdown-left",T.fire("action:tag.filter.options",{el:t,options:i});const o=t.find('[component="tag/filter/search"]');i.selectedTags=i.selectedTags||ajaxify.data.selectedTags||[];let d=null,e=[],r=[];Array.isArray(i.selectedTags)?e=i.selectedTags.map(String):Array.isArray(ajaxify.data.selectedTags)&&(e=ajaxify.data.selectedTags.map(String)),r=e.slice();const y=o.parents('[component="tag/filter"]').length&&app.user.privileges["search:tags"];t.on("show.bs.dropdown",function(){y&&o.removeClass("hidden");function p(){const h=o.find("input").val();h.length>1||!h&&!d?s(h,function(C){d=d||C,m(C)}):!h&&d&&m(d)}o.on("click",function(h){h.preventDefault(),h.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(p,300)),p()}),t.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||o.find("input").focus()}),t.on("hidden.bs.dropdown",function(){y&&o.addClass("hidden"),o.off("click"),o.find("input").off("keyup");let p=r.length!==e.length;if(r.forEach(function(h,C){h!==e[C]&&(p=!0)}),r=e.slice(),p&&(i.updateButton?i.updateButton({el:t,changed:p,selectedTags:e.slice()}):i.updateButton!==!1&&w(t,e)),i.onHidden){i.onHidden({changed:p,selectedTags:e.slice()});return}if(p){let h=window.location.pathname;const C=utils.params();e.length?C.tag=e.length?e:void 0:delete C.tag,delete C.page,Object.keys(C).length&&(h+="?"+$.param(C)),ajaxify.go(h)}}),t.on("click",'[component="tag/filter/list"] [data-tag]',function(){const p=t.find('[component="tag/filter/list"]'),h=$(this),C=h.find("a").attr("href");if(C&&C!=="#"&&C.length)return;const D=h.attr("data-tag"),M=h.find('[component="tag/select/icon"]');return D!==""?(e.includes(D)?e.splice(e.indexOf(D),1):e.push(D),e.sort(function(j,b){return j-b}),M.toggleClass("invisible")):(t.find('[component="tag/select/icon"]').addClass("invisible"),e=[]),p.find('[data-tag=""] i').toggleClass("invisible",!!e.length),i.selectedTags=e,i.onSelect&&i.onSelect({tag:D,selectedTags:e.slice()}),!1});function s(p,h){let C=null;ajaxify.data.template.category||ajaxify.data.template.world?C=[ajaxify.data.cid]:Array.isArray(ajaxify.data.selectedCids)&&ajaxify.data.selectedCids.length&&(C=ajaxify.data.selectedCids),socket.emit("topics.tagFilterSearch",{query:p,cids:C},function(D,M){if(D)return L.error(D);h(M)})}function m(p){const h=i.selectedTags;p.forEach(function(C){C.selected=h.includes(C.value)}),app.parseAndTranslate(i.template,{tagItems:p.slice(0,200),selectedTag:ajaxify.data.selectedTag},function(C){t.find('[component="tag/filter/list"]').html(C.find('[component="tag/filter/list"]').html());const D=u.Dropdown.getInstance(t.find(".dropdown-toggle").get(0));D&&D.update()})}};function w(t,i){i.length>0?o({label:i.join(", ")}):o();function o(d){app.parseAndTranslate("partials/tags/filter-dropdown-content",{selectedTag:d},function(e){t.find("button").replaceWith($("<div/>").html(e).find("button"))})}}return E}).apply(B,P),A!==void 0&&(F.exports=A)}),39259:((F,B,l)=>{var P,A;P=[l(96349),l(49897),l(91749)],A=(function(T,L,u){const E={};E.init=function(t,i){if(!t||!t.length)return;i=i||{},i.states=i.states||["watching","tracking","notwatching","ignoring"],i.template=i.template||"partials/category/filter-dropdown-left",u.fire("action:category.filter.options",{el:t,options:i}),T.init(t,i);let o=[],d=[];Array.isArray(i.selectedCids)?o=i.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(o=ajaxify.data.selectedCids.map(String)),d=o.slice(),t.on("hidden.bs.dropdown",function(){let e=d.length!==o.length;if(d.forEach(function(r,y){r!==o[y]&&(e=!0)}),d=o.slice(),e&&(i.updateButton?i.updateButton({el:t,changed:e,selectedCids:o.slice()}):i.updateButton!==!1&&w(t,o)),i.onHidden){i.onHidden({changed:e,selectedCids:o.slice()});return}if(e){let r=window.location.pathname;const y=utils.params();o.length?y.cid=o:delete y.cid,delete y.page,Object.keys(y).length&&(r+="?"+$.param(y)),ajaxify.go(r)}}),t.on("click",'[component="category/list"] [data-cid]',function(e){const r=t.find('[component="category/list"]'),y=$(this),s=y.find("a").attr("href");if(s&&s!=="#"&&s.length){e.stopPropagation();return}const m=y.attr("data-cid"),p=y.find('[component="category/select/icon"]');return m!=="all"?(o.includes(m)?o.splice(o.indexOf(m),1):o.push(m),o.sort(function(h,C){return h-C}),p.toggleClass("invisible"),r.find('[data-cid="all"] i').toggleClass("invisible",!!o.length)):(t.find('[component="category/select/icon"]').addClass("invisible"),r.find('[data-cid="all"] i').removeClass("invisible"),o=[]),i.selectedCids=o,i.onSelect&&i.onSelect({cid:m,selectedCids:o.slice()}),!1})};function w(t,i){i.length>1?o({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):i.length===1?L.get(`/categories/${i[0]}`,{}).then(o):o();function o(d){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:d},function(e){t.find("button").replaceWith($("<div/>").html(e).find("button"))})}}return E}).apply(B,P),A!==void 0&&(F.exports=A)}),47682:((F,B,l)=>{var P,A;P=[l(22410),l(60644),l(70550),l(39259),l(25955),l(71131),l(91749)],A=(function(T,L,u,E,w,t,i){const o={};let d="",e=0,r=0,y,s;const m=[];$(window).on("action:ajaxify.start",function(){o.removeListeners(),t.removeListeners()}),o.init=function(g,f){s=p(),d=g,y=f||j,t.init(),o.watchForNewPosts();const v=["watching","tracking"];ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"?v.push("notwatching","ignoring"):g!=="unread"&&v.push("notwatching"),E.init($('[component="category/dropdown"]'),{states:v}),w.init($('[component="tag/filter"]')),config.usePagination||T.init(o.loadMoreTopics),L.init(function(k,n){y(k,1,function(c,a){N(d,c,ajaxify.data.showSelect,1,function(){n(),a()})})}),$("body").height()<=$(window).height()&&s.children().length>=20&&$("#load-more-btn").show(),$("#load-more-btn").on("click",function(){o.loadMoreTopics(1)}),i.fire("action:topics.loaded",{topics:ajaxify.data.topics})};function p(){return $('[component="category"]').filter(function(g,f){return!$(f).parents("[widget-area],[data-widget-area]").length})}o.watchForNewPosts=function(){r=0,e=0,o.removeListeners(),socket.on("event:new_topic",h),socket.on("event:new_post",C)},o.removeListeners=function(){socket.removeListener("event:new_topic",h),socket.removeListener("event:new_post",C)};function h(g){const f=ajaxify.data,v=f.selectedCids&&f.selectedCids.length&&f.selectedCids.indexOf(parseInt(g.cid,10))===-1,k=f.selectedFilter&&f.selectedFilter.filter==="watched",n=f.template.category&&parseInt(f.cid,10)!==parseInt(g.cid,10),c=!!(v||k||n||m.includes(g.tid));i.fire("filter:topicList.onNewTopic",{topic:g,preventAlert:c}).then(a=>{a.preventAlert||(g.scheduled&&g.tid&&m.push(g.tid),e+=1,D())})}function C(g){const f=g.posts[0];if(!f||!f.topic||f.topic.isFollowing)return;const v=ajaxify.data,k=parseInt(f.topic.mainPid,10)===parseInt(f.pid,10),n=v.selectedCids&&v.selectedCids.length&&v.selectedCids.indexOf(parseInt(f.topic.cid,10))===-1,c=v.selectedFilter&&v.selectedFilter.filter==="new",a=v.selectedFilter&&v.selectedFilter.filter==="watched"&&!f.topic.isFollowing,x=v.template.category&&parseInt(v.cid,10)!==parseInt(f.topic.cid,10),I=!!(k||n||c||a||x);i.fire("filter:topicList.onNewPost",{post:f,preventAlert:I}).then(S=>{S.preventAlert||(r+=1,D())})}function D(){(e>0||r>0)&&($("#new-topics-alert").removeClass("hide").fadeIn("slow"),$("#category-no-topics").addClass("hide"))}o.loadMoreTopics=function(g){if(!s.length||!s.children().length)return;const f=s.find('[component="category/topic"]'),v=g>0?f.last():f.first(),k=(parseInt(v.attr("data-index"),10)||0)+(g>0?1:0);!utils.isNumber(k)||k===0&&s.find('[component="category/topic"][data-index="0"]').length||y(k,g,function(n,c){N(d,n,ajaxify.data.showSelect,g,c)})};function M(g,f){return Math.floor(g/config.topicsPerPage)+(f>0?1:0)}function j(g,f,v){v=v||function(){};const k=utils.params();k.page=M(g,f),T.loadMoreXhr(k,v)}function b(g){return g.filter(function(f){return!s.find('[component="category/topic"][data-tid="'+f.tid+'"]').length})}function N(g,f,v,k,n){let{topics:c}=f;if(!c||!c.length||(c=b(c),!c.length))return $("#load-more-btn").hide(),n();let a,x;const I=s.find('[component="category/topic"]');k>0&&c.length?a=I.last():k<0&&c.length&&(x=I.first());const S={topics:c,showSelect:v,"reputation:disabled":f["reputation:disabled"],template:{name:g}};S.template[g]=!0,i.fire("action:topics.loading",{topics:c,after:a,before:x}),app.parseAndTranslate(g,"topics",S,function(R){if(s.removeClass("hidden"),$("#category-no-topics").remove(),a&&a.length)R.insertAfter(a);else if(x&&x.length){const K=$(document).height(),W=$(window).scrollTop();R.insertBefore(x),$(window).scrollTop(W+($(document).height()-K))}else s.append(R);u.getSelectedTids().length||T.removeExtra(s.find('[component="category/topic"]'),k,Math.max(60,config.topicsPerPage*3)),R.find(".timeago").timeago(),i.fire("action:topics.loaded",{topics:c,template:g}),n()})}return o}).apply(B,P),A!==void 0&&(F.exports=A)}),70550:((F,B,l)=>{var P,A;P=[l(52473)],A=(function(T){const L={};let u,E;L.init=function(e){E=$('[component="category"]'),E.on("selectstart",'[component="topic/select"]',function(r){r.preventDefault()}),E.on("click",'[component="topic/select"]',function(r){const s=$(this).parents('[component="category/topic"]');if(r.shiftKey)return i(s.attr("data-tid")),u=s,!1;const m=s.hasClass("selected");w(s,!m),u=s,typeof e=="function"&&e()})};function w(e,r){const y=e.find('[component="topic/select"]');y.toggleClass("fa-check-square-o",r),y.toggleClass("fa-square-o",!r),y.parents('[component="category/topic"]').toggleClass("selected",r),t()}function t(){const e=$('[component="topic/selected/badge"]');if(e.length){const r=E.find('[component="category/topic"].selected').length;e.text(r>0?r:"")}}L.getSelectedTids=function(){const e=[];return E&&E.find('[component="category/topic"].selected').each(function(){e.push($(this).attr("data-tid"))}),e},L.unselectAll=function(){E&&(E.find('[component="category/topic"].selected').removeClass("selected"),E.find('[component="topic/select"]').toggleClass("fa-check-square-o",!1).toggleClass("fa-square-o",!0),t())};function i(e){u||(u=$('[component="category/topic"]').first());const r=T.get("category/topic","tid",e).hasClass("selected"),y=d(e),s=d(u.attr("data-tid"));o(y,s,!r)}function o(e,r,y){if(e>r){const s=e;e=r,r=s}for(let s=e;s<=r;s+=1){const m=$('[component="category/topic"]').eq(s);w(m,y)}}function d(e){return T.get("category/topic","tid",e).index('[component="category/topic"]')}return L}).apply(B,P),A!==void 0&&(F.exports=A)}),71131:((F,B,l)=>{var P,A;P=[l(70550),l(60984),l(52473),l(49897),l(33530),l(29930)],A=(function(T,L,u,E,w,t){const i={};i.init=function(){T.init(s),k(),$('[component="category/topic"]').each((n,c)=>{L.observeTopicLabels($(c).find('[component="topic/labels"]'))}),u.get("topic/delete").on("click",function(){return o("del","/state","delete",r),!1}),u.get("topic/restore").on("click",function(){return o("put","/state","restore",r),!1}),u.get("topic/purge").on("click",function(){return o("del","","purge",y),!1}),u.get("topic/lock").on("click",function(){return o("put","/lock","lock",e),!1}),u.get("topic/unlock").on("click",function(){return o("del","/lock","unlock",e),!1}),u.get("topic/pin").on("click",function(){return o("put","/pin","pin",e),!1}),u.get("topic/unpin").on("click",function(){return o("del","/pin","unpin",e),!1}),u.get("topic/mark-unread-for-all").on("click",function(){const n=T.getSelectedTids();return n.length?(socket.emit("topics.markAsUnreadForAll",n,function(c){if(c)return t.error(c);t.success("[[topic:markAsUnreadForAll.success]]"),n.forEach(function(a){$('[component="category/topic"][data-tid="'+a+'"]').addClass("unread")}),e()}),!1):t.error("[[error:no-topics-selected]]")}),u.get("topic/move").on("click",function(){return l.e(28310).then(function(){var n=[l(28310)];(function(c){const a=T.getSelectedTids();if(!a.length)return t.error("[[error:no-topics-selected]]");c.init(a,null,e)}).apply(null,n)}).catch(l.oe),!1}),u.get("topic/move-all").on("click",function(){const n=ajaxify.data.cid;if(!ajaxify.data.template.category)return t.error("[[error:invalid-data]]");l.e(28310).then(function(){var c=[l(28310)];(function(a){a.init(null,n,function(x){if(x)return t.error(x);ajaxify.refresh()})}).apply(null,c)}).catch(l.oe)}),u.get("topic/merge").on("click",function(){const n=T.getSelectedTids();l.e(2403).then(function(){var c=[l(2403)];(function(a){a.init(function(){n.length&&n.forEach(function(x){a.addTopic(x)})})}).apply(null,c)}).catch(l.oe)}),u.get("topic/tag").on("click",async function(){const n=T.getSelectedTids();if(!n.length)return t.error("[[error:no-topics-selected]]");const c=await Promise.all(n.map(a=>E.get(`/topics/${a}`)));Promise.all([l.e(20056),l.e(63)]).then(function(){var a=[l(63)];(function(x){x.init(c,ajaxify.data.tagWhitelist,e)}).apply(null,a)}).catch(l.oe)}),i.removeListeners(),socket.on("event:topic_deleted",b),socket.on("event:topic_restored",b),socket.on("event:topic_purged",v),socket.on("event:topic_locked",g),socket.on("event:topic_unlocked",g),socket.on("event:topic_pinned",N),socket.on("event:topic_unpinned",N),socket.on("event:topic_moved",f)};function o(n,c,a,x){x||(x=function(){});const I=T.getSelectedTids(),S={},R=function(K){K&&Promise.all(I.map(W=>E[n](`/topics/${W}${c}`,S))).then(x).catch(t.error)};if(!I.length)return t.error("[[error:no-topics-selected]]");switch(a){case"delete":case"restore":case"purge":w.confirm(`[[topic:thread-tools.${a}-confirm]]`,R);break;case"pin":L.requestPinExpiry(S,R.bind(null,!0));break;default:R(!0);break}}i.removeListeners=function(){socket.removeListener("event:topic_deleted",b),socket.removeListener("event:topic_restored",b),socket.removeListener("event:topic_purged",v),socket.removeListener("event:topic_locked",g),socket.removeListener("event:topic_unlocked",g),socket.removeListener("event:topic_pinned",N),socket.removeListener("event:topic_unpinned",N),socket.removeListener("event:topic_moved",f)};function d(){$(".thread-tools .show").removeClass("show")}function e(){d(),T.unselectAll()}function r(){d(),s()}function y(){d(),T.unselectAll(),s()}function s(){const n=T.getSelectedTids(),c=m(h,n),a=p(h,n),x=m(D,n),I=m(C,n),S=m(M,n),R=p(M,n);u.get("topic/delete").toggleClass("hidden",c),u.get("topic/restore").toggleClass("hidden",S||!c),u.get("topic/purge").toggleClass("hidden",!a||!n.length),u.get("topic/lock").toggleClass("hidden",I),u.get("topic/unlock").toggleClass("hidden",!I),u.get("topic/pin").toggleClass("hidden",R||x),u.get("topic/unpin").toggleClass("hidden",R||!x),u.get("topic/merge").toggleClass("hidden",S)}function m(n,c){for(let a=0;a<c.length;a+=1)if(n(c[a]))return!0;return!1}function p(n,c){for(let a=0;a<c.length;a+=1)if(!n(c[a]))return!1;return!0}function h(n){return j(n).hasClass("deleted")}function C(n){return j(n).hasClass("locked")}function D(n){return j(n).hasClass("pinned")}function M(n){return j(n).hasClass("scheduled")}function j(n){return u.get("category/topic","tid",n)}function b(n){const c=j(n.tid);c.toggleClass("deleted",n.isDeleted),c.find('[component="topic/locked"]').toggleClass("hidden",!n.isDeleted)}function N(n){const c=j(n.tid);c.toggleClass("pinned",n.isPinned),c.find('[component="topic/pinned"]').toggleClass("hidden",!n.isPinned),ajaxify.refresh()}function g(n){const c=j(n.tid);c.toggleClass("locked",n.isLocked),c.find('[component="topic/locked"]').toggleClass("hidden",!n.isLocked)}function f(n){j(n.tid).remove()}function v(n){j(n.tid).remove()}function k(){if(!ajaxify.data.topics||!ajaxify.data.template.category)return;const n=ajaxify.data.topics.filter(c=>c.pinned).length;!app.user.isAdmin&&!app.user.isMod||n<2||app.loadJQueryUI(function(){const c=$('[component="category"]').filter(function(x,I){return!$(I).parents("[widget-area],[data-widget-area]").length});let a=0;c.sortable({axis:"y",handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',start:function(){a=parseInt(c.find('[component="category/topic"].pinned').first().attr("data-index"),10)},update:function(x,I){const S=I.item.attr("data-tid"),R=c.find('[component="category/topic"].pinned');let K=0;R.each((W,U)=>{if($(U).attr("data-tid")===S)return K=W,!1}),socket.emit("topics.orderPinnedTopics",{tid:S,order:a+K},function(W){if(W)return t.error(W);R.each((U,Y)=>{$(Y).attr("data-index",a+U)})})}})})}return i}).apply(B,P),A!==void 0&&(F.exports=A)}),96349:((F,B,l)=>{var P,A;P=[l(29930),l(89336),l(49897)],A=(function(T,L,u){const E={};return E.init=function(w,t){let i=t.defaultCategories||null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","tracking","notwatching","ignoring"],t.cacheList=t.hasOwnProperty("cacheList")?t.cacheList:!0;let o=[];Array.isArray(t.localCategories)&&(o=t.localCategories.map(s=>({...s})),i&&(i=[...o,...i])),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const d=w.find('[component="category-selector-search"]');if(!d.length)return;const e=d.parents('[component="category/dropdown"]').length>0||d.parents('[component="category-selector"]').length>0;w.on("show.bs.dropdown",function(){e&&d.removeClass("hidden");function s(){const m=d.find("input").val();m.length>1||!m&&!i?r(m,function(p){i=t.cacheList&&(i||p),y(p)}):!m&&i&&y(i)}d.on("click",function(m){m.preventDefault(),m.stopPropagation()}),d.find("input").val("").on("keyup",utils.debounce(s,300)),s()}),w.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||d.find("input").focus()}),w.on("hide.bs.dropdown",function(){e&&d.addClass("hidden"),d.off("click"),d.find("input").off("keyup")});function r(s,m){u.get("/search/categories",{search:s,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks},function(p,{categories:h}){if(p)return T.error(p);m(o.concat(h))})}function y(s){const m=t.selectedCids.map(String);s.forEach(function(p){p.selected=m.includes(String(p.cid))}),app.parseAndTranslate(t.template,{categoryItems:s.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(p){w.find('[component="category/list"]').html(p.find('[component="category/list"]').html()),w.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!s.length);const h=L.Dropdown.getInstance(w.find(".dropdown-toggle").get(0));h&&h.update()})}},E}).apply(B,P),A!==void 0&&(F.exports=A)})}]);
