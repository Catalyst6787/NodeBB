"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13417,15794,25432,26174,34271,34405,49897,53020,78289,95737,99127],{13230:((M,P,u)=>{var h,v,k;(function(E){v=[u(53050)],h=E,k=typeof h=="function"?h.apply(P,v):h,k!==void 0&&(M.exports=k)})(function(E){const N=E("[^\\p{L}\\s\\d\\-_@.]","g"),b=/[^\w\s\d\-_@.]/g,A=/^\s+|\s+$/g,m=/\s+/g,i=/-+/g,L=/-$/g,w=/^-/g,g=/^[\w\d\s.,\-@]+$/;return function(t,o){return t?(t=String(t).replace(A,""),g.test(t)?t=t.replace(b,"-"):t=E.replace(t,N,"-"),t=o?t:t.toLocaleLowerCase(),t=t.replace(m,"-"),t=t.replace(i,"-"),t=t.replace(L,""),t=t.replace(w,""),t):""}})}),29869:(M=>{M.exports=function(P,u,h){u.setGlobal("true",!0),u.setGlobal("false",!1);const v=1440*60*1e3,k={displayMenuItem:N,buildMetaTag:b,buildLinkTag:A,stringify:m,escape:i,stripTags:L,buildCategoryIcon:w,buildCategoryLabel:g,generateCategoryBackground:x,generateChildrenCategories:t,generateTopicClass:o,membershipBtn:l,spawnPrivilegeStates:D,localeToHTML:B,renderTopicImage:C,renderDigestAvatar:I,userAgentIcons:c,buildAvatar:d,increment:S,generateWroteReplied:R,generateRepliedTo:U,generateWrote:H,encodeURIComponent:G,isoTimeToLocaleString:Y,shouldHideReplyContainer:J,humanReadableNumber:V,formattedNumber:O,txEscape:a,uploadBasename:s,generatePlaceholderWave:p,register:f,__escape:E};function E(e){return e}function N(e,n){const r=e.navigation[n];return!(!r||r.route.match("/users")&&e.user&&!e.user.privileges["view:users"]||r.route.match("/tags")&&e.user&&!e.user.privileges["view:tags"]||r.route.match("/groups")&&e.user&&!e.user.privileges["view:groups"])}function b(e){const n=e.name?'name="'+e.name+'" ':"",r=e.property?'property="'+e.property+'" ':"",y=e.content?'content="'+e.content.replace(/\n/g," ")+'" ':"";return"<meta "+n+r+y+`/>
	`}function A(e){const n=["link","rel","as","type","href","sizes","title","crossorigin"],[r,y,W,T,j,z,K,_]=n.map(F=>e[F]?`${F}="${e[F]}" `:"");return"<link "+r+y+W+T+z+K+j+_+`/>
	`}function m(e){return JSON.stringify(e).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/g,"&quot;")}function i(e){return P.escapeHTML(e)}function L(e){return P.stripHTMLTags(e)}function w(e,n,r){return e?`<span class="icon d-inline-flex justify-content-center align-items-center align-middle ${r}" style="${x(e)} width:${n}; height: ${n}; font-size: ${parseInt(n,10)/2}px;">${e.icon?`<i class="fa fa-fw ${e.icon}"></i>`:""}</span>`:""}function g(e,n="a",r=""){if(!e)return"";const y=n==="a"?`href="${h}/category/${e.slug}"`:"";return`<${n} ${y} class="badge px-1 text-truncate text-decoration-none ${r}" style="color: ${e.color};background-color: ${e.bgColor};border-color: ${e.bgColor}!important; max-width: 70vw;">
			${e.icon&&e.icon!=="fa-nbb-none"?`<i class="fa fa-fw ${e.icon}"></i>`:""}
			${e.name}
		</${n}>`}function x(e){if(!e)return"";const n=[];return e.bgColor&&(n.push("background-color: "+e.bgColor),n.push(`border-color: ${e.bgColor}!important`)),e.color&&n.push("color: "+e.color),e.backgroundImage&&(n.push("background-image: url("+e.backgroundImage+")"),e.imageClass&&n.push("background-size: "+e.imageClass)),n.join("; ")+";"}function t(e){let n="";return!e||!e.children||!e.children.length||(e.children.forEach(function(r){if(r&&!r.isSection){const y=r.link?r.link:h+"/category/"+r.slug;n+='<span class="category-children-item float-start"><div role="presentation" class="icon float-start" style="'+x(r)+'"><i class="fa fa-fw '+r.icon+'"></i></div><a href="'+y+'"><small>'+r.name+"</small></a></span>"}}),n=n&&'<span class="category-children">'+n+"</span>"),n}function o(e){return["locked","pinned","deleted","unread","scheduled"].filter(r=>!!e[r]).join(" ")}function l(e,n=""){return e.isMember&&e.name!=="administrators"?`<button class="btn btn-danger ${n}" data-action="leave" data-group="${e.displayName}" ${e.disableLeave?" disabled":""}><i class="fa fa-times"></i> [[groups:membership.leave-group]]</button>`:e.isPending&&e.name!=="administrators"?`<button class="btn btn-warning disabled ${n}"><i class="fa fa-clock-o"></i> [[groups:membership.invitation-pending]]</button>`:e.isInvited?`<button class="btn btn-warning" data-action="rejectInvite" data-group="${e.displayName}">[[groups:membership.reject]]</button><button class="btn btn-success" data-action="acceptInvite" data-group="${e.name}"><i class="fa fa-plus"></i> [[groups:membership.accept-invitation]]</button>`:!e.disableJoinRequests&&e.name!=="administrators"?`<button class="btn btn-success ${n}" data-action="join" data-group="${e.displayName}"><i class="fa fa-plus"></i> [[groups:membership.join-group]]</button>`:""}function D(e,n,r,y){const W=[];for(const[T,j]of Object.entries(r))W.push({name:T,state:j,type:y[T]});return W.map(function(T){const j=["groups:moderate","groups:posts:upvote","groups:posts:downvote","groups:local:login","groups:group:create"],z=["groups:find","groups:read","groups:topics:read","groups:view:users","groups:view:tags","groups:view:groups"],K=["groups:moderate"];let _=["groups:view:users","groups:find","groups:read","groups:topics:read","groups:topics:create","groups:topics:reply","groups:topics:tag","groups:posts:edit","groups:posts:history","groups:posts:delete","groups:posts:upvote","groups:posts:downvote","groups:topics:delete"];e===-1&&(_=_.slice(3));const F=n==="guests"&&(j.includes(T.name)||T.name.startsWith("groups:admin:"))||n==="spiders"&&!z.includes(T.name)||n==="fediverse"&&!_.includes(T.name)||n==="Global Moderators"&&K.includes(T.name);return`
				<td data-privilege="${T.name}" data-value="${T.state}" data-type="${T.type}">
					<div class="form-check text-center">
						<input class="form-check-input float-none${F?' d-none"':""}" autocomplete="off" type="checkbox"${T.state?" checked":""}${F?' disabled="disabled" aria-diabled="true"':""} />
					</div>
				</td>
			`}).join("")}function B(e,n){return e=e||n||"en-GB",e.replace("_","-")}function C(e){return e.thumb?'<img src="'+e.thumb+'" class="img-circle user-img" title="'+e.user.displayname+'" />':'<img component="user/picture" data-uid="'+e.user.uid+'" src="'+e.user.picture+'" class="user-img" title="'+e.user.displayname+'" />'}function I(e){return e.teaser?e.teaser.user.picture?'<img style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%;" src="'+e.teaser.user.picture+'" title="'+e.teaser.user.username+'" />':'<div style="vertical-align: middle; width: 32px; height: 32px; line-height: 32px; font-size: 16px; background-color: '+e.teaser.user["icon:bgColor"]+'; color: white; text-align: center; display: inline-block; border-radius: 50%;">'+e.teaser.user["icon:text"]+"</div>":e.user.picture?'<img style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%;" src="'+e.user.picture+'" title="'+e.user.username+'" />':'<div style="vertical-align: middle; width: 32px; height: 32px; line-height: 32px; font-size: 16px; background-color: '+e.user["icon:bgColor"]+'; color: white; text-align: center; display: inline-block; border-radius: 50%;">'+e.user["icon:text"]+"</div>"}function c(e){let n="";switch(e.platform){case"Linux":n+='<i class="fa fa-fw fa-linux"></i>';break;case"Microsoft Windows":n+='<i class="fa fa-fw fa-windows"></i>';break;case"Apple Mac":n+='<i class="fa fa-fw fa-apple"></i>';break;case"Android":n+='<i class="fa fa-fw fa-android"></i>';break;case"iPad":n+='<i class="fa fa-fw fa-tablet"></i>';break;case"iPod":case"iPhone":n+='<i class="fa fa-fw fa-mobile"></i>';break;default:n+='<i class="fa fa-fw fa-question-circle"></i>';break}switch(e.browser){case"Chrome":n+='<i class="fa fa-fw fa-chrome"></i>';break;case"Firefox":n+='<i class="fa fa-fw fa-firefox"></i>';break;case"Safari":n+='<i class="fa fa-fw fa-safari"></i>';break;case"IE":n+='<i class="fa fa-fw fa-internet-explorer"></i>';break;case"Edge":n+='<i class="fa fa-fw fa-edge"></i>';break;default:n+='<i class="fa fa-fw fa-question-circle"></i>';break}return n}function d(e,n,r,y,W){e||(e=this),y=y||"";const T=new Map([["title",e.displayname],["data-uid",e.uid],["class",`avatar ${y}${r?" avatar-rounded":""}`]]),j=[`--avatar-size: ${n};`],z=_=>Array.from(_).reduce((F,[Q,X])=>(F+=` ${Q}="${X}"`,F),"");let K="";return e.picture&&(K+=`<img${z(T)} alt="${e.displayname}" loading="lazy" component="${W||"avatar/picture"}" src="${e.picture}" style="${j.join(" ")}" onError="this.remove()" itemprop="image" />`),K+=`<span${z(T)} component="${W||"avatar/icon"}" style="${j.join(" ")} background-color: ${e["icon:bgColor"]}">${e["icon:text"]}</span>`,K}function S(e,n){return String(e+parseInt(n,10))}function R(e,n){return e.toPid?U(e,n):H(e,n)}function U(e,n){const r=e.parent&&e.parent.displayname?e.parent.displayname:"[[global:guest]]";return`[[topic:replied-to-user-${e.timestamp<Date.now()-n*v?"on":"ago"}, ${e.toPid}, ${h}/post/${encodeURIComponent(e.toPid)}, ${r}, ${h}/post/${encodeURIComponent(e.pid)}, ${e.timestampISO}]]`}function H(e,n){return`[[topic:wrote-${e.timestamp<Date.now()-n*v?"on":"ago"}, ${h}/post/${encodeURIComponent(e.pid)}, ${e.timestampISO}]]`}function G(e){return encodeURIComponent(e)}function Y(e,n="en-GB"){return new Date(e).toLocaleString([n],{dateStyle:"short",timeStyle:"short"}).replace(/,/g,"&#44;")}function J(e){return!!(e.replies.count<=0||e.replies.hasSingleImmediateReply)}function V(e,n=1){return P.makeNumberHumanReadable(e,n)}function O(e){return P.addCommas(e)}function a(e){return String(e).replace(/%/g,"&#37;").replace(/,/g,"&#44;")}function s(e,n="/"){const r=/^\d+-/,y=e.substr(e.lastIndexOf(n)+1);return r.test(y)?y.slice(14):y}function p(e){return e.map(r=>r==="divider"?'<li class="dropdown-divider"></li>':`
			<li class="dropdown-item placeholder-wave">
				<div class="placeholder" style="width: 20px;"></div>
				<div class="placeholder col-${r}"></div>
			</li>`).join("")}function f(){Object.keys(k).forEach(function(e){u.registerHelper(e,k[e])})}return k}}),30076:((M,P,u)=>{var h,v;const k=u(29869);h=[u(77918),u(81335)],v=(function(E,N){return k(E,N,config.relative_path)}).apply(P,h),v!==void 0&&(M.exports=v)}),30637:((M,P,u)=>{var h,v;h=[u(49897),u(81335),u(33530),u(29930)],v=(function(k,E,N,b){const A={};function m(){return ajaxify.data.template.name.startsWith("admin/")}return A.handle=function(){$('[component="user/invite"]').on("click",function(i){i.preventDefault(),k.get(`/api/v3/users/${app.user.uid}/invites/groups`,{}).then(L=>{E.parse("modals/invite",{groups:L},function(w){N.dialog({message:w,title:`[[${m()?"admin/manage/users:invite":"users:invite"}]]`,onEscape:!0,buttons:{cancel:{label:`[[${m()?"admin/manage/users:alerts.button-cancel":"modules:bootbox.cancel"}]]`,className:"btn-default"},invite:{label:`[[${m()?"admin/manage/users:invite":"users:invite"}]]`,className:"btn-primary",callback:A.send}}})})}).catch(b.error)})},A.send=function(){const i=$("#invite-modal-emails"),L=$("#invite-modal-groups"),w={emails:i.val().split(",").map(g=>g.trim()).filter(Boolean).filter((g,x,t)=>x===t.indexOf(g)).join(","),groupsToJoin:L.val()};w.emails&&k.post(`/users/${app.user.uid}/invites`,w).then(()=>{b.success(`[[${m()?"admin/manage/users:alerts.email-sent-to":"users:invitation-email-sent"}, ${w.emails.replace(/,/g,"&#44; ")}]]`)}).catch(b.error)},A}).apply(P,h),v!==void 0&&(M.exports=v)}),34405:((M,P,u)=>{var h,v;h=[u(49897),u(29930),u(36e3),u(9787),u(35786)],v=(function(k,E,{Textcomplete:N},{TextareaEditor:b},{ContenteditableEditor:A}){const m={},i={delay:200,appendTo:null};m.init=w=>{const g={...i,...w},{input:x,onSelect:t}=g;app.loadJQueryUI(function(){x.autocomplete({...g,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(o,l){L(x,t,o,l)}})})},m.user=function(w,g,x){typeof g=="function"&&(x=g,g={}),g=g||{},m.init({input:w,onSelect:x,source:(t,o)=>{g.query=t.term,k.get("/api/users",g,function(l,D){if(l)return E.error(l);if(D&&D.users){const B=D.users.map(function(C){const I=$("<div></div>").html(C.username).text();return C&&{label:I,value:I,user:{uid:C.uid,name:C.username,slug:C.userslug,username:C.username,userslug:C.userslug,displayname:C.displayname,picture:C.picture,banned:C.banned,"icon:text":C["icon:text"],"icon:bgColor":C["icon:bgColor"]}}});o(B)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},m.group=function(w,g){m.init({input:w,onSelect:g,source:(x,t)=>{socket.emit("groups.search",{query:x.term},function(o,l){if(o)return E.error(o);if(l&&l.length){const D=l.map(function(B){return B&&{label:B.name,value:B.name,group:B}});t(D)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},m.tag=function(w,g){m.init({input:w,onSelect:g,delay:100,source:(x,t)=>{socket.emit("topics.autocompleteTags",{query:x.term,cid:ajaxify.data.cid||0},function(o,l){if(o)return E.error(o);l&&t(l),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function L(w,g,x,t){g=g||function(){};const o=jQuery.Event("keypress");o.which=13,o.keyCode=13,setTimeout(function(){w.trigger(o)},100),g(x,t)}return m.setup=function({element:w,strategies:g,options:x}){const t=w.get(0);if(t){var o;if(t.nodeName==="TEXTAREA"||t.nodeName==="INPUT"?o=new b(t):t.nodeName==="DIV"&&t.getAttribute("contenteditable")==="true"&&(o=new A(t)),!o)throw new Error("unknown target element type");t.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var l=new N(o,g,{dropdown:x});return l.on("rendered",function(){l.dropdown.items.length&&l.dropdown.items[0].activate()}),l}},m}).apply(P,h),v!==void 0&&(M.exports=v)}),49897:((M,P,u)=>{u.r(P),u.d(P,{del:()=>x,get:()=>m,head:()=>i,patch:()=>w,post:()=>L,put:()=>g});var h=u(91749),v=u.n(h),k=u(33530),E=u.n(k);const N=config.relative_path+"/api/v3";async function b(t,o){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:N+t.url,typeof o=="function"){A(t).then(l=>o(null,l),l=>o(l));return}try{return await A(t)}catch(l){if(l.message==="A valid login session was not found. Please log in and try again."){const{url:D}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,k.confirm)("[[error:api.reauth-required]]",B=>{B&&ajaxify.go(D)})}throw l}}async function A(t){const{url:o}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,h.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const l=await fetch(o,t),{headers:D}=l;if(D.get("x-redirect"))return A({url:D.get("x-redirect"),...t});const B=D.get("content-type"),C=B&&B.startsWith("application/json");let I;if(t.method!=="HEAD"&&(C?I=await l.json():I=await l.text()),!l.ok)throw I?new Error(C?I.status.message:I):new Error(l.statusText);return C&&I&&I.hasOwnProperty("status")&&I.hasOwnProperty("response")?I.response:I}function m(t,o,l){return b({url:t+(o&&Object.keys(o).length?"?"+$.param(o):"")},l)}function i(t,o,l){return b({url:t+(o&&Object.keys(o).length?"?"+$.param(o):""),method:"HEAD"},l)}function L(t,o,l){return b({url:t,method:"POST",data:o,headers:{"x-csrf-token":config.csrf_token}},l)}function w(t,o,l){return b({url:t,method:"PATCH",data:o,headers:{"x-csrf-token":config.csrf_token}},l)}function g(t,o,l){return b({url:t,method:"PUT",data:o,headers:{"x-csrf-token":config.csrf_token}},l)}function x(t,o,l){return b({url:t,method:"DELETE",data:o,headers:{"x-csrf-token":config.csrf_token}},l)}}),86296:((M,P,u)=>{var h,v;h=[u(49897),u(33530),u(29930)],v=(function(k,E,N){const b={};return b.init=function(A){const m=E.dialog({message:`
				<label class="form-label">[[admin/manage/users:new-email]]</label>
				<input id="newEmail" class="form-control" type="text" value="${utils.escapeHTML(A.email||"")}">
			`,title:"[[admin/manage/users:change-email]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},change:{label:"[[admin/manage/users:alerts.button-change]]",className:"btn-primary",callback:function(){const i=m.find("#newEmail").val();return k.post("/users/"+A.uid+"/emails",{skipConfirmation:!0,email:i}).then(()=>{m.modal("hide"),A.onSuccess(i)}).catch(N.error),!1}}}})},b}).apply(P,h),v!==void 0&&(M.exports=v)}),91847:((M,P,u)=>{var h,v;h=[u(17459),u(81335),u(34405),u(49897),u(13230),u(33530),u(29930),u(30637),u(30076),u(86296)],v=(function(k,E,N,b,A,m,i,L,w,g){const x={};x.init=function(){$("#results-per-page").val(ajaxify.data.resultsPerPage).on("change",function(){const a=utils.params();a.resultsPerPage=$("#results-per-page").val();const s=D(a);ajaxify.go(window.location.pathname+"?"+s)}),$(".export-csv").on("click",function(){socket.once("event:export-users-csv",function(){i.remove("export-users-start"),i.alert({alert_id:"export-users",type:"success",title:"[[global:alert.success]]",message:"[[admin/manage/users:export-users-completed]]",clickfn:function(){window.location.href=config.relative_path+"/api/admin/users/csv"},timeout:0})});const s=[{label:"[[admin/manage/users:export-field-email]]",field:"email",selected:!0},{label:"[[admin/manage/users:export-field-username]]",field:"username",selected:!0},{label:"[[admin/manage/users:export-field-uid]]",field:"uid",selected:!0},{label:"[[admin/manage/users:export-field-ip]]",field:"ip",selected:!0},{label:"[[admin/manage/users:export-field-joindate]]",field:"joindate",selected:!1},{label:"[[admin/manage/users:export-field-lastonline]]",field:"lastonline",selected:!1},{label:"[[admin/manage/users:export-field-lastposttime]]",field:"lastposttime",selected:!1},{label:"[[admin/manage/users:export-field-reputation]]",field:"reputation",selected:!1},{label:"[[admin/manage/users:export-field-postcount]]",field:"postcount",selected:!1},{label:"[[admin/manage/users:export-field-topiccount]]",field:"topiccount",selected:!1},{label:"[[admin/manage/users:export-field-profileviews]]",field:"profileviews",selected:!1},{label:"[[admin/manage/users:export-field-followercount]]",field:"followerCount",selected:!1},{label:"[[admin/manage/users:export-field-followingcount]]",field:"followingCount",selected:!1},{label:"[[admin/manage/users:export-field-fullname]]",field:"fullname",selected:!1},{label:"[[admin/manage/users:export-field-birthday]]",field:"birthday",selected:!1},{label:"[[admin/manage/users:export-field-signature]]",field:"signature",selected:!1},{label:"[[admin/manage/users:export-field-aboutme]]",field:"aboutme",selected:!1}].concat(ajaxify.data.customUserFields.map(f=>({label:f.name,field:f.key,selected:!1}))).map((f,e)=>`
				<div class="form-check mb-2">
					<input data-field="${f.field}" class="form-check-input" type="checkbox" id="option-${e}" ${f.selected?"checked":""}>
					<label class="form-check-label" for="option-${e}">
						${f.label}
					</label>
				</div>`).join(""),p=m.dialog({message:s,title:"[[admin/manage/users:export-users-fields-title]]",buttons:{submit:{label:"[[admin/manage/users:export]]",callback:function(){const f=p.find("[data-field]").filter((e,n)=>$(n).is(":checked")).map((e,n)=>$(n).attr("data-field")).get();socket.emit("admin.user.exportUsersCSV",{fields:f},function(e){if(e)return i.error(e);i.alert({alert_id:"export-users-start",message:"[[admin/manage/users:export-users-started]]",timeout:Math.max(5e3,ajaxify.data.userCount/5e3*500)})})}}}});return!1});function c(){const a=[];return $('.users-table [component="user/select/single"]').each(function(){$(this).is(":checked")&&a.push($(this).attr("data-uid"))}),a}function d(a,s){$('.users-table [component="user/select/single"]:checked').parents(".user-row").find(a).each(function(){$(this).toggleClass("hidden",!s)})}function S(){$('.users-table [component="user/select/single"]').prop("checked",!1),$('.users-table [component="user/select/all"]').prop("checked",!1)}function R(a){const s=document.querySelector(`.users-table [component="user/select/single"][data-uid="${a}"]`);if(s){const p=s.closest(".user-row");p.parentNode.removeChild(p)}}function U(a,s,p){return function(f){if(f)return i.error(f);i.success(a),s&&d(s,p),S()}}function H(a,s,p){i.success(a),s&&d(s,p),S()}$('[component="user/select/all"]').on("click",function(){$('.users-table [component="user/select/single"]').prop("checked",$(this).is(":checked"))}),$(".manage-groups").on("click",function(){const a=c();if(!a.length)return i.error("[[error:no-users-selected]]"),!1;socket.emit("admin.user.loadGroups",a,function(s,p){if(s)return i.error(s);E.render("admin/partials/manage_user_groups",p).then(function(f){const e=m.dialog({message:f,title:"[[admin/manage/users:manage-groups]]",onEscape:!0});e.on("shown.bs.modal",function(){N.group(e.find(".group-search"),function(n,r){const y=$(n.target).attr("data-uid");b.put("/groups/"+r.item.group.slug+"/membership/"+y,void 0).then(()=>{r.item.group.nameEscaped=k.escape(r.item.group.displayName),app.parseAndTranslate("admin/partials/manage_user_groups",{users:[{groups:[r.item.group]}]},function(W){$("[data-uid="+y+"] .group-area").append(W.find(".group-area").html())})}).catch(i.error)})}),e.on("click",".group-area a",function(){e.modal("hide")}),e.on("click",".remove-group-icon",function(){const n=$(this).parents("[data-group-name]"),r=n.attr("data-group-name"),y=$(this).parents("[data-uid]").attr("data-uid");return b.del("/groups/"+A(r)+"/membership/"+y).then(()=>{n.remove()}).catch(i.error),!1})})})}),$(".set-reputation").on("click",function(){const a=c();if(!a.length)return i.error("[[error:no-users-selected]]"),!1;let s="";if(a.length===1){const f=ajaxify.data.users.find(e=>e&&e.uid===parseInt(a[0],10));f&&(s=String(f.reputation))}const p=m.dialog({message:`<input id="new-reputation" type="text" class="form-control" value="${s}">`,title:"[[admin/manage/users:set-reputation]]",onEscape:!0,buttons:{submit:{label:"[[global:save]]",callback:function(){const f=p.find("#new-reputation").val();if(!utils.isNumber(f))return i.error("[[error:invalid-data]]"),!1;socket.emit("admin.user.setReputation",{value:f,uids:a}).then(()=>{a.forEach(e=>{$(`[component="user/reputation"][data-uid="${e}"]`).text(w.formattedNumber(f));const n=ajaxify.data.users.find(r=>r&&r.uid===parseInt(e,10));n&&(n.reputation=f)})}).catch(i.error)}}}});p.on("shown.bs.modal",()=>{p.find("#new-reputation").selectRange(0,p.find("#new-reputation").val().length)})}),$(".ban-user").on("click",function(){const a=c();if(!a.length)return i.error("[[error:no-users-selected]]"),!1;m.confirm(a.length>1?"[[admin/manage/users:alerts.confirm-ban-multi]]":"[[admin/manage/users:alerts.confirm-ban]]",function(s){s&&Promise.all(a.map(function(p){return b.put("/users/"+p+"/ban")})).then(()=>{H("[[admin/manage/users:alerts.ban-success]]",".ban",!0)}).catch(i.error)})}),$(".ban-user-temporary").on("click",function(){const a=c();if(!a.length)return i.error("[[error:no-users-selected]]"),!1;E.render("modals/temporary-ban",{}).then(function(s){const p=m.dialog({title:"[[user:ban-account]]",message:s,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[admin/manage/users:alerts.button-ban-x, "+a.length+"]]",callback:function(){const f=p.find("form").serializeArray().reduce(function(n,r){return n[r.name]=r.value,n},{}),e=f.length>0?Date.now()+f.length*1e3*60*60*(parseInt(f.unit,10)?24:1):0;Promise.all(a.map(function(n){return b.put("/users/"+n+"/ban",{until:e,reason:f.reason})})).then(()=>{H("[[admin/manage/users:alerts.ban-success]]",".ban",!0)}).catch(i.error)}}}})})}),$(".unban-user").on("click",function(){const a=c();if(!a.length)return i.error("[[error:no-users-selected]]"),!1;E.render("modals/unban",{}).then(function(s){const p=m.dialog({title:"[[user:unban-account]]",message:s,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:unban-account]]",callback:function(){const f=p.find("form").serializeArray().reduce(function(e,n){return e[n.name]=n.value,e},{});Promise.all(a.map(function(e){return b.del("/users/"+e+"/ban",{reason:f.reason||""})})).then(()=>{H("[[admin/manage/users:alerts.unban-success]]",".ban",!1)}).catch(i.error)}}}})})}),$(".reset-lockout").on("click",function(){const a=c();a.length&&socket.emit("admin.user.resetLockouts",a,U("[[admin/manage/users:alerts.lockout-reset-success]]"))}),$(".change-email").on("click",function(){const a=c();if(a.length!==1)return i.error("[[admin/manage/users:alerts.select-a-single-user-to-change-email]]");g.init({uid:a[0],onSuccess:function(s){d(".notvalidated",!1),d(".pending",!1),d(".expired",!1),d(".validated",!1),d(".validated-by-admin",!!s),d(".no-email",!s),$('.users-table [component="user/select/single"]:checked').parents(".user-row").find(".validated-by-admin .email").text(s)}})}),$(".validate-email").on("click",function(){const a=c();a.length&&m.confirm("[[admin/manage/users:alerts.confirm-validate-email]]",function(s){s&&socket.emit("admin.user.validateEmail",a,function(p){if(p)return i.error(p);i.success("[[admin/manage/users:alerts.validate-email-success]]"),d(".notvalidated",!1),d(".pending",!1),d(".expired",!1),d(".validated",!1),d(".validated-by-admin",!0),S()})})}),$(".send-validation-email").on("click",function(){const a=c();a.length&&socket.emit("admin.user.sendValidationEmail",a,function(s){if(s)return i.error(s);i.success("[[notifications:email-confirm-sent]]")})}),$(".change-password").on("click",async function(){const a=c();if(!a.length)return;async function s(f){const e=f.find("#newPassword").val(),n=f.find("#confirmPassword").val();if(e!==n)throw new Error("[[[user:change-password-error-match]]");await Promise.all(a.map(r=>b.put("/users/"+r+"/password",{currentPassword:"",newPassword:e})))}const p=m.dialog({message:`<div class="d-flex flex-column gap-2">
					<label class="form-label">[[user:new-password]]</label>
					<input id="newPassword" class="form-control" type="text">
					<label class="form-label">[[user:confirm-password]]</label>
					<input id="confirmPassword" class="form-control" type="text">
				</div>`,title:"[[admin/manage/users:change-password]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},change:{label:"[[admin/manage/users:alerts.button-change]]",className:"btn-primary",callback:function(){return s(p).then(()=>{p.modal("hide")}).catch(i.error),!1}}}})}),$(".password-reset-email").on("click",function(){const a=c();a.length&&m.confirm("[[admin/manage/users:alerts.password-reset-confirm]]",function(s){s&&socket.emit("admin.user.sendPasswordResetEmail",a,U("[[admin/manage/users:alerts.password-reset-email-sent]]"))})}),$(".force-password-reset").on("click",function(){const a=c();a.length&&m.confirm("[[admin/manage/users:alerts.confirm-force-password-reset]]",function(s){s&&socket.emit("admin.user.forcePasswordReset",a,U("[[admin/manage/users:alerts.validate-force-password-reset-success]]"))})}),$(".delete-user").on("click",()=>{J("[[admin/manage/users:alerts.confirm-delete]]","/account")}),$(".delete-user-content").on("click",()=>{J("[[admin/manage/users:alerts.confirm-delete-content]]","/content")}),$(".delete-user-and-content").on("click",()=>{J("[[admin/manage/users:alerts.confirm-purge]]","")});const G=document.querySelector(".users-table"),Y=document.getElementById("action-dropdown");G.addEventListener("change",a=>{(a.target.closest('[component="user/select/single"]')||a.target.closest('[component="user/select/all"]'))&&(c().length?Y.removeAttribute("disabled"):Y.setAttribute("disabled","disabled"))});function J(a,s){const p=c();p.length&&m.confirm(a,function(f){f&&Promise.all(p.map(e=>b.del(`/users/${encodeURIComponent(e)}${s}`,{}).then(()=>{s!=="/content"&&R(e)}))).then(()=>{s!=="/content"?i.success("[[admin/manage/users:alerts.delete-success]]"):i.success("[[admin/manage/users:alerts.delete-content-success]]"),S(),$('.users-table [component="user/select/single"]').length||ajaxify.refresh()}).catch(i.error)})}function V(){$('[data-action="create"]').on("click",function(){return E.render("admin/partials/create_user_modal",{}).then(function(a){const s=m.dialog({message:a,title:"[[admin/manage/users:alerts.create]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},create:{label:"[[admin/manage/users:alerts.button-create]]",className:"btn-primary",callback:function(){return O.call(this),!1}}}});s.on("shown.bs.modal",function(){s.find("#create-user-name").focus()})}),!1})}function O(){const a=this,s=document.getElementById("create-user-name").value,p=document.getElementById("create-user-email").value,f=document.getElementById("create-user-password").value,e=document.getElementById("create-user-password-again").value,n=$("#create-modal-error");if(f!==e)return n.translateHtml("[[admin/manage/users:alerts.error-x, [[admin/manage/users:alerts.error-passwords-different]]]]").removeClass("hide");const r={username:s,email:p,password:f};b.post("/users",r).then(()=>{a.modal("hide"),a.on("hidden.bs.modal",function(){ajaxify.refresh()}),i.success("[[admin/manage/users:alerts.create-success]]")}).catch(y=>n.translateHtml("[[admin/manage/users:alerts.error-x, "+y.message+"]]").removeClass("hidden"))}t(),V(),B(),I(),L.handle()};function t(){function c(){$(".fa-spinner").removeClass("hidden"),o({searchBy:$("#user-search-by").val(),query:$("#user-search").val(),page:1})}$("#user-search").on("keyup",utils.debounce(c,250)),$("#user-search-by").on("change",c)}function o(c){const d=utils.params();d.searchBy=c.searchBy,d.query=c.query,d.page=c.page,d.sortBy=d.sortBy||"lastonline";const S=$.param(d);$.get(config.relative_path+"/api/admin/manage/users?"+S,function(R){l(R);const U=config.relative_path+"/admin/manage/users?"+S;history.pushState&&history.pushState({url:U},null,window.location.protocol+"//"+window.location.host+U)}).fail(function(R){R&&R.responseJSON&&R.responseJSON.error&&i.error(R.responseJSON.error)})}function l(c){E.render("partials/paginator",{pagination:c.pagination}).then(function(d){$(".pagination-container").replaceWith(d)}),app.parseAndTranslate("admin/manage/users","users",c,function(d){if($(".users-table tbody tr").remove(),$(".users-table tbody").append(d),d.find(".timeago").timeago(),$(".fa-spinner").addClass("hidden"),!$("#user-search").val()){$("#user-found-notify").addClass("hidden"),$("#user-notfound-notify").addClass("hidden");return}c&&c.users.length===0?($("#user-notfound-notify").translateHtml("[[admin/manage/users:search.not-found]]").removeClass("hidden"),$("#user-found-notify").addClass("hidden")):($("#user-found-notify").translateHtml(k.compile("admin/manage/users:alerts.x-users-found",c.matchCount,c.timing)).removeClass("hidden"),$("#user-notfound-notify").addClass("hidden"))})}function D(c){return $("#user-search").val()?(c.query=$("#user-search").val(),c.searchBy=$("#user-search-by").val()):(delete c.query,delete c.searchBy),$.param(c)}function B(){$(".users-table thead th").on("click",function(){const d=$(this).attr("data-sort");if(!d)return;const S=utils.params();S.sortBy=d,ajaxify.data.sortBy===d?S.sortDirection=ajaxify.data.reverse?"asc":"desc":S.sortDirection="desc";const R=D(S);ajaxify.go("admin/manage/users?"+R)})}function C(){const c=[];return $("#filter-by").find("[data-filter-by]").each(function(){$(this).find(".fa-check").length&&c.push($(this).attr("data-filter-by"))}),c}function I(){let c=C();$("#filter-by").on("click","li",function(){const d=$(this);return d.find("i").toggleClass("fa-check",!d.find("i").hasClass("fa-check")),!1}),$("#filter-by").on("hidden.bs.dropdown",function(){const d=C();let S=d.length!==c.length;if(d.length===c.length&&d.forEach(function(R,U){R!==c[U]&&(S=!0)}),c=C(),S){const R=utils.params();R.filters=d;const U=D(R);ajaxify.go("admin/manage/users?"+U)}})}return x}).apply(P,h),v!==void 0&&(M.exports=v)})}]);
